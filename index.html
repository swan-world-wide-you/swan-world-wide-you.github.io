<!DOCTYPE html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/brain.js"></script>
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
</head>
<body>
  <div class="container">
    <h1>ColorPickAI</h1>
    <div class="input-group mb-4">
      <div class="input-group-text">色を選んでください</div>
      <div class="form-control">
        <input type="color" id="input_color" class="form-control">
      </div>
      <button onclick="isDark()" class="btn btn-primary">明暗判定</button>
    </div>
    <div>
      <div id="judge_result" class="mb-4"></div>
    </div>
    <div class="input-group mb-4">
      <div class="input-group-text">AIの判定</div>
      <div id="result" class="form-control"></div>
    </div>
  </div>
    <script>
        // brain.js はじめ
        const net = new brain.recurrent.LSTMTimeStep({
          inputSize: 2,
          hiddenLayers: [10],
          outputSize: 2,
        });

        // Same test as previous, but combined on a single set
        const trainingData = [
          [
            [1, 5],
            [2, 4],
            [3, 3],
            [4, 2],
            [5, 1],
          ],
        ];

        net.train(trainingData, { log: true, errorThresh: 0.09 });

        const closeToFiveAndOne = net.run([
          [1, 5],
          [2, 4],
          [3, 3],
          [4, 2],
        ]);

        console.log(closeToFiveAndOne);

        // now we're cookin' with gas!
        const forecast = net.forecast(
          [
            [1, 5],
            [2, 4],
          ],
          3
        );

        console.log('next 3 predictions', forecast);
        // brain.js おわり
        
        // ニューラルネットワークによる色判定
        const net2 = new brain.NeuralNetwork();
        // Train the Network with 4 input objects
        net2.train([
        // White RGB(255, 255, 255)
        {input:[255/255, 255/255, 255/255], output:{light:1}},
        // Light grey (192,192,192)
        {input:[192/255, 192/255, 192/255], output:{light:1}},
        // Darkgrey (64, 64, 64)
        {input:[65/255, 65/255, 65/255], output:{dark:1}},
        // Black (0, 0, 0)
        {input:[0, 0, 0], output:{dark:1}},
        ]);

        function isDark(){
        // What is the expected output of Dark Blue (0, 0, 128);
        const color = document.getElementById("input_color").value;
        console.log(color);
        const rHex = parseInt(color.substr(1,2),16);
        const gHex = parseInt(color.substr(3,2),16);
        const bHex = parseInt(color.substr(5,2),16);
        const r = parseInt(rHex,10) / 255;
        const g = parseInt(gHex,10) / 255;
        const b = parseInt(bHex,10) / 255;
        console.log(rHex,gHex,bHex);
        let result = net2.run([r, g, b]);

        // Display the probability of "dark" and "light"
        document.getElementById("result").innerHTML = "暗い確率:" + Math.round(result["dark"]*100) + "% / 明るい確率" + Math.round(result["light"]*100) + "%";
            
        if(result["dark"] > result["light"]){
            document.getElementById("judge_result").innerHTML = "暗い🌑";
        }else{
            document.getElementById("judge_result").innerHTML = "明るい🌞";
        }
        }
    
    </script>
</body>
</html>
